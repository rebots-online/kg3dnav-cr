# Checklist â€” LLM Connectivity & Neo4j Endpoint Normalization (2025-09-27)

## Preconditions
- [x] Confirm no existing persisted settings mock interfering with new defaults.
- [x] Ensure TypeScript types compile without new dependencies.

## Implementation Tasks
1. `src/state/settingsStore.ts`
   - [x] Add helper `normalizeNeo4jUri(raw: string | undefined): string` with scheme coercion.
   - [x] Apply helper when constructing defaults, applying drafts, returning snapshots.
   - [x] Export helper if needed by services.
2. `src/services/hkgLoader.ts`
   - [x] Import `normalizeNeo4jUri` (or replicate logic) to sanitize bolt endpoint.
   - [x] After driver creation, call `await driver.verifyConnectivity()` with timeout guard.
   - [x] Improve error logging/messages for connectivity failure.
3. `src/services/llmClient.ts`
   - [x] Introduce provider-specific base normalization functions (Ollama/OpenRouter).
   - [x] Enhance fetch error handling, returning descriptive messages.
   - [x] Use dynamic `Referer` header when running in browser.
4. `src/components/ConnectionSettingsDrawer.tsx`
   - [x] Replace datalist inputs with dropdown combobox + optional custom model entry for Ollama/OpenRouter.
   - [x] Update `syncModels` to call provider-aware tag/model endpoints and parse results.
   - [x] Surface loading/error status near dropdown; disable dropdown while loading.
5. `src/components/AINavigationChat.tsx`
   - [x] Display active provider + model from settings snapshot in message footer instead of static text.
   - [x] Update failure fallback copy to reference settings drawer.

## Validation
- [x] Run `npm run lint` to ensure formatting. *(fails due to pre-existing lint violations across project)*
- [x] Smoke-test TypeScript build via `npm run build`. *(fails: Vite cannot bundle `neo4j-driver` in current setup)*

## Post-Work
- [x] Update this checklist statuses before final commit.
- [x] Prepare PR summary referencing architecture file.

